<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AirUSB Super App</title>
    <style>
        :root { --primary: #00ff88; --bg: #0a0a0a; --panel: #161616; --text: #eee; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 20px; }
        .auth-card { background: var(--panel); padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        nav { background: var(--panel); display: flex; justify-content: space-around; padding: 10px; border-top: 1px solid #333; order: 2; }
        nav button { background: none; border: none; color: #777; font-size: 12px; cursor: pointer; transition: 0.3s; }
        nav button.active { color: var(--primary); transform: scale(1.1); }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .page { flex: 1; display: none; flex-direction: column; overflow: hidden; }
        .page.active { display: flex; }

        /* –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π */
        .feed-item { background: var(--panel); margin: 10px; padding: 15px; border-radius: 15px; }
        .post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #333; }

        /* –ß–∞—Ç */
        #chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 18px; position: relative; font-size: 14px; line-height: 1.4; }
        .msg.me { align-self: flex-end; background: #004d33; border-bottom-right-radius: 2px; }
        .msg.not-me { align-self: flex-start; background: #222; border-bottom-left-radius: 2px; }
        .msg-info { font-size: 10px; color: #888; margin-top: 5px; display: flex; justify-content: space-between; gap: 10px; }

        /* –û–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
        input { background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
        .btn { background: var(--primary); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; }
        header { background: var(--panel); padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #333; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 style="color:var(--primary)">AirUSB</h2>
            <input type="email" id="authEmail" placeholder="Email">
            <input type="password" id="authPass" placeholder="–ü–∞—Ä–æ–ª—å">
            <input type="text" id="authNick" placeholder="–ù–∏–∫–Ω–µ–π–º (–¥–ª—è –Ω–æ–≤—ã—Ö)">
            <button class="btn" id="loginBtn">–í–æ–π—Ç–∏</button>
            <p style="font-size: 12px; margin: 15px 0; color: #666;">–∏–ª–∏</p>
            <button class="btn" id="regBtn" style="background:none; border:1px solid var(--primary); color:var(--primary)">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
    </div>

    <header id="header-title">–ß–∞—Ç</header>

    <div id="page-chat" class="page active">
        <div id="chat-messages"></div>
        <div style="padding:15px; background:var(--panel); display:flex; gap:10px;">
            <input type="text" id="msgInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0">
            <button id="sendBtn" class="btn" style="width:60px">‚û§</button>
        </div>
    </div>

    <div id="page-feed" class="page">
        <div style="padding:15px; border-bottom:1px solid #333">
            <input type="text" id="postInput" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" style="margin:0">
            <button id="postBtn" class="btn" style="margin-top:10px">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
        <div id="feed-container" style="flex:1; overflow-y:auto"></div>
    </div>

    <nav>
        <button onclick="showPage('chat', this)" class="active">üí¨<br>–ß–∞—Ç</button>
        <button onclick="showPage('feed', this)">üì∞<br>–õ–µ–Ω—Ç–∞</button>
        <button onclick="logout()">üö™<br>–í—ã–π—Ç–∏</button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDdOZrTcE4ATDlGldnW8_dWRmHuaUuJfak",
            authDomain: "mysuperchat-d1c29.firebaseapp.com",
            projectId: "mysuperchat-d1c29",
            storageBucket: "mysuperchat-d1c29.firebasestorage.app",
            messagingSenderId: "299888628640",
            appId: "1:299888628640:web:caf0535b94e389c7948ac5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
        document.getElementById('regBtn').onclick = async () => {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPass').value;
            const nick = document.getElementById('authNick').value;
            try {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(res.user, { 
                    displayName: nick, 
                    photoURL: `https://api.dicebear.com/7.x/bottts/svg?seed=${nick}` 
                });
                location.reload();
            } catch (e) { alert(e.message); }
        };

        document.getElementById('loginBtn').onclick = async () => {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPass').value;
            try { await signInWithEmailAndPassword(auth, email, pass); } catch (e) { alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞"); }
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').style.display = 'none';
                initChat();
                initFeed();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
            }
        });

        // --- –õ–û–ì–ò–ö–ê –°–¢–†–ê–ù–ò–¶ ---
        window.showPage = (pageId, btn) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('header-title').innerText = pageId === 'chat' ? '–ß–∞—Ç' : '–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π';
        };

        // --- –ß–ê–¢ ---
        async function initChat() {
            const q = query(collection(db, "messages"), orderBy("time", "asc"));
            onSnapshot(q, (snapshot) => {
                const box = document.getElementById('chat-messages');
                box.innerHTML = "";
                snapshot.forEach(doc => {
                    const m = doc.data();
                    const isMe = m.uid === currentUser.uid;
                    const time = m.time ? new Date(m.time.seconds * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '...';
                    
                    box.innerHTML += `
                        <div class="msg ${isMe ? 'me' : 'not-me'}">
                            <div style="display:flex; align-items:center; gap:5px; margin-bottom:3px">
                                <img src="${m.avatar}" class="avatar" style="width:15px; height:15px">
                                <b style="font-size:10px; color:var(--primary)">${m.user}</b>
                            </div>
                            ${m.text}
                            <div class="msg-info"><span>${time}</span></div>
                        </div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        document.getElementById('sendBtn').onclick = async () => {
            const text = document.getElementById('msgInput').value;
            if(!text.trim()) return;
            await addDoc(collection(db, "messages"), {
                text, user: currentUser.displayName, uid: currentUser.uid, 
                avatar: currentUser.photoURL, time: serverTimestamp()
            });
            document.getElementById('msgInput').value = "";
        };

        // --- –õ–ï–ù–¢–ê ---
        async function initFeed() {
            const q = query(collection(db, "posts"), orderBy("time", "desc"));
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('feed-container');
                container.innerHTML = "";
                snapshot.forEach(doc => {
                    const p = doc.data();
                    container.innerHTML += `
                        <div class="feed-item">
                            <div class="post-header">
                                <img src="${p.avatar}" class="avatar">
                                <b>${p.user}</b>
                            </div>
                            <p>${p.text}</p>
                        </div>`;
                });
            });
        }

        document.getElementById('postBtn').onclick = async () => {
            const text = document.getElementById('postInput').value;
            if(!text.trim()) return;
            await addDoc(collection(db, "posts"), {
                text, user: currentUser.displayName, avatar: currentUser.photoURL, time: serverTimestamp()
            });
            document.getElementById('postInput').value = "";
        };
    </script>
</body>
</html>